<table class="table table-striped table-sm fs-9 mb-0">
    <thead>
        <tr>
            <th class="border-top ps-3">
                <input type="checkbox" id="select-all">
            </th>
            <th class="sort border-top border-translucent ps-3" data-sort="name">Tên nguồn gọi</th>
            <th class="sort border-top" data-sort="email">Tổng KH</th>
            <th class="sort border-top" data-sort="age">Tạo bởi</th>
        </tr>
    </thead>
    <tbody>
        {% for callsource in callsources %}
            <tr>
                <td class="border-top ps-3">
                    <input type="checkbox" class="row-checkbox" value="{{ callsource.id }}">
                </td>
                <td class="name">{{ callsource.name_call_source }}</td>
                <td class="email">{{ callsource.total_customers }}</td>
                <td class="age">{{ callsource.create_by }}</td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="9" class="text-center">Không có dữ liệu</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        function updateCheckboxHandlers() {
            const selectAllCheckbox = document.getElementById("select-all");
            const rowCheckboxes = document.querySelectorAll(".row-checkbox");

            // Khi click vào "Chọn tất cả"
            selectAllCheckbox.addEventListener("change", function () {
                rowCheckboxes.forEach(checkbox => {
                    checkbox.checked = selectAllCheckbox.checked;
                });
            });

            // Khi chọn hoặc bỏ chọn từng hàng
            rowCheckboxes.forEach(checkbox => {
                checkbox.addEventListener("change", function () {
                    selectAllCheckbox.checked = [...rowCheckboxes].every(cb => cb.checked);
                });
            });
        }

        // Cập nhật lại checkbox khi dữ liệu bảng thay đổi do HTMX
        document.body.addEventListener("htmx:afterSwap", function (event) {
            if (event.target.id === "callsource-body") {
                updateCheckboxHandlers();
            }
        });

        // Gán sự kiện lần đầu
        updateCheckboxHandlers();
    });
</script>
